{% extends 'BackOfficeBundle:Metronic:body-page-content-form.html.twig' %}
{% trans_default_domain 'AppBundleMessage' %}

{% block moreCss %}

    <!-- BEGIN PAGE LEVEL PLUGINS -->
    {% stylesheets
    '@BackOfficeBundle/Resources/public/assets/global/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css'
    output='assets/global/plugins/bootstrap-datepicker/css/bootstrap-datepicker3.min.css' %}
    <link rel="stylesheet" href="{{ asset_url }}" type="text/css"/>
    {% endstylesheets %}

    {% stylesheets
    '@BackOfficeBundle/Resources/public/assets/global/plugins/jquery-minicolors/jquery.minicolors.css'
    output='assets/global/plugins/jquery-minicolors/jquery.minicolors.css' %}
    <link rel="stylesheet" href="{{ asset_url }}" type="text/css"/>
    {% endstylesheets %}

    {% stylesheets
    '@BackOfficeBundle/Resources/public/assets/global/plugins/jquery-nestable/jquery.nestable.css'
    output='assets/global/plugins/jquery-nestable/jquery.nestable.css' %}
    <link rel="stylesheet" href="{{ asset_url }}" type="text/css"/>
    {% endstylesheets %}
    <!-- END PAGE LEVEL PLUGINS -->

{% endblock moreCss %}
  {% block moreJsBefore %}
      {% javascripts
      '@BackOfficeBundle/Resources/public/assets/global/plugins/jquery.min.js' %}
      <script src="{{ asset_url }}"></script>
      {% endjavascripts %}
  {% endblock moreJsBefore %}
{% block moreJs %}
    {% javascripts
    '@BackOfficeBundle/Resources/public/assets/global/plugins/moment.min.js'
    '@BackOfficeBundle/Resources/public/assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js' %}
    <script src="{{ asset_url }}"></script>
    {% endjavascripts %}

    {% javascripts
    '@BackOfficeBundle/Resources/public/assets/global/plugins/jquery-nestable/jquery.nestable.js' %}
    <script src="{{ asset_url }}"></script>
    {% endjavascripts %}

    <script type="text/javascript">
        $(document).ready(function () {

            var updateOutput = function () {
                var i = 0;
                var array = jQuery('.dd li').map(function () {
                    return '{"id":"' + $(this).attr("data-id") + '", "order":"' + ++i + '"}';
                }).get();
                var artiste = ',"artiste":"' + $(this).attr("artiste-id") + '"';
                var order = '{' + '"dossier":[' + array.join(',') + "]" + artiste + '}';
                console.log(order);
                $.ajax({
                    data: 'data=' + order,
                    cache: false,
                    type: 'POST',
                    url: "{{ path ('admin_artiste_dossier_categorie_edit_order') }}",
                    success: function (data) {
                        console.log(data);
                    }
                });
            };


            if ($('.dd').length) {
                $('.dd').nestable({
                    group: 1,
                    maxDepth: 2
                }).on('change', updateOutput);
            }

            $(function () {
                $('#ddabundle_artistebundle_artiste_dateDeNaissance').datetimepicker({
                    format: "dd/mm/yyyy",
                    autoclose: "true",
                    pickerPosition: "bottom-left",
                    language: "fr"
                });
                $('#ddabundle_artistebundle_artiste_dateDeDeces').datetimepicker({
                    format: "dd/mm/yyyy",
                    autoclose: "true",
                    pickerPosition: "bottom-left",
                    language: "fr"
                });

            })
        });

    </script>

{% endblock moreJs %}

{% set form = edit_form %}
{% set title_page = 'editer un Artiste' %}
{% set path_entity_index = 'admin_artiste_index' %}
{% set table_size = 'col-md-6' %}
{% block content_AB %}
    {{ render(controller('ddaBundleArtisteBundle:Artiste:gerer', {'id':artiste.id})) }}
{% endblock content_AB %}
